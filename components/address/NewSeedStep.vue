<template>
  <Form :submit="onSubmit.bind(this)">
    <h2 class="session-title">Backup code</h2>
    <div class="session-main bottom-indent reorder">
      <Seed :value="fieldSeed" />

      <FormGroup
        :error="$v.fieldWarning.$error"
        class="field-checkbox"
        field-id="sign-up-warning"
        field-label
      >
        <div class="field-checkbox-input">
          <label class="field-checkbox-label" for="sign-up-warning">
            <input
              id="sign-up-warning"
              v-model="fieldWarning"
              v-focus
              type="checkbox"
            />
            I understand that lost seeds cannot be recovered.</label
          >
        </div>
        <FormMessage
          v-if="$v.fieldWarning.$error && !$v.fieldWarning.required"
          name="Recovery confirmation"
          type="required"
        />
      </FormGroup>
    </div>
    <div class="session-footer">
      <Button value="Next" type="submit" />
    </div>
  </Form>
</template>

<script>
import { sameAs } from 'vuelidate/lib/validators'

export default {
  name: `new-seed-step`,
  props: {
    seed: {
      type: String,
      default: () => undefined,
    },
  },
  data: () => ({
    fieldSeed: undefined,
    fieldWarning: false,
  }),
  mounted() {
    this.getSeed()
  },
  methods: {
    async getSeed() {
      if (!this.seed) {
        const { Secp256k1HdWallet } = await import('@cosmjs/launchpad')
        this.fieldSeed = (await Secp256k1HdWallet.generate(24)).mnemonic
      } else {
        this.fieldSeed = this.seed
      }
    },
    onSubmit() {
      this.$v.$touch()
      if (this.$v.$error) return
      this.$emit('submit', this.fieldSeed)
    },
  },
  validations: () => ({
    fieldWarning: { required: sameAs(() => true) },
  }),
}
</script>
